---
// ExampleSnippet.astro
import { Code } from 'astro:components';
import prettier from 'prettier';
import * as htmlPlugin from 'prettier/plugins/html';

interface Props {
  code: string;
  title?: string;
  description?: string;
}

const { code, title, description } = Astro.props;

let formattedCode = code;
try {
  formattedCode = await prettier.format(code, {
    parser: 'html',
    plugins: [htmlPlugin],
    printWidth: 60,
    htmlWhitespaceSensitivity: 'css',
    tabWidth: 2,
    useTabs: false,
  });
} catch (e) {
  console.warn('ExampleSnippet: Failed to format snippet with Prettier:', e);
  // Fallback to original code if prettier fails
}
---

<div class="card shadow-sm mb-4">
  {
    title && (
      <div class="card-header bg-light py-3">
        <h5 class="card-title mb-0 fw-bold">{title}</h5>
      </div>
    )
  }
  <div class="card-body">
    {description && <p class="card-text text-muted mb-4">{description}</p>}

    <!-- Live Preview -->
    <div class="p-4 border rounded bg-white mb-3">
      <h6 class="text-uppercase text-muted fw-bold small mb-3 ls-1">
        <i class="bi bi-eye me-2"></i>Preview
      </h6>
      <div class="preview-content">
        <slot>
          <Fragment set:html={code} />
        </slot>
      </div>
    </div>

    <!-- Code Display -->
    <div class="bg-light p-3 rounded position-relative">
      <h6 class="text-uppercase text-muted fw-bold small mb-2 ls-1">
        <i class="bi bi-code-slash me-2"></i>HTML Source
      </h6>
      <div class="code-wrapper">
        <Code code={formattedCode} lang="html" theme="github-light" />
      </div>
    </div>
  </div>
</div>

<style>
  .preview-content {
    overflow-x: auto;
  }
  .code-wrapper {
    max-height: 400px;
    overflow-y: auto;
  }
  /* Override Shiki's default background to match card */
  :global(.code-wrapper pre.astro-code) {
    background-color: transparent !important;
    margin-bottom: 0;
  }
</style>
