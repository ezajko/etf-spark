---
// ETF UNSA - Pagination Component
// Author: Ernedin Zajko <ezajko@root.ba>
// License: GPL-2.0-or-later

interface Props {
  currentPage: number;
  totalPages: number;
  baseUrl: string; // e.g., "/news" or "/news/"
  class?: string;
}

const { currentPage, totalPages, baseUrl, class: className } = Astro.props;

// Helper to ensure trailing slash logic
const cleanBaseUrl = baseUrl.endsWith('/') ? baseUrl : `${baseUrl}/`;

const prevPage = currentPage > 1 ? `${cleanBaseUrl}${currentPage - 1}` : null;
const nextPage = currentPage < totalPages ? `${cleanBaseUrl}${currentPage + 1}` : null;

// Logic to generate page numbers (simplified for now: shows all if < 7, otherwise ellipsize)
// For robustness, full ellipsize logic can be complex. We'll implement a reasonable sliding window.
function getPageNumbers(current: number, total: number) {
  const delta = 2;
  const range: (number | string)[] = [];
  for (let i = Math.max(2, current - delta); i <= Math.min(total - 1, current + delta); i++) {
    range.push(i);
  }

  if (current - delta > 2) range.unshift('...');
  if (current + delta < total - 1) range.push('...');

  range.unshift(1);
  if (total !== 1) range.push(total);

  return range;
}

const pages = getPageNumbers(currentPage, totalPages);
---

<nav class={`ez-pagination ${className || ''}`} aria-label="Page navigation">
  <ul class="pagination justify-content-center">
    <!-- Previous -->
    <li class={`page-item ${!prevPage ? 'disabled' : ''}`}>
      <a
        class="page-link"
        href={prevPage || '#'}
        aria-label="Previous"
        tabindex={!prevPage ? '-1' : undefined}
      >
        <i class="bi bi-chevron-left"></i>
      </a>
    </li>

    <!-- Numbers -->
    {
      pages.map((page) => (
        <li
          class={`page-item ${page === currentPage ? 'active' : ''} ${page === '...' ? 'disabled' : ''}`}
        >
          {page === '...' ? (
            <span class="page-link border-0">...</span>
          ) : (
            <a class="page-link" href={`${cleanBaseUrl}${page}`}>
              {page}
            </a>
          )}
        </li>
      ))
    }

    <!-- Next -->
    <li class={`page-item ${!nextPage ? 'disabled' : ''}`}>
      <a
        class="page-link"
        href={nextPage || '#'}
        aria-label="Next"
        tabindex={!nextPage ? '-1' : undefined}
      >
        <i class="bi bi-chevron-right"></i>
      </a>
    </li>
  </ul>
</nav>
