---
// ThemeSwitcher.astro
---

<div class="dropdown d-inline-block">
  <button
    class="btn btn-link text-white-50 p-2 text-decoration-none dropdown-toggle"
    type="button"
    id="themeDropdown"
    data-bs-toggle="dropdown"
    aria-expanded="false"
    title="Appearance"
  >
    <i class="bi bi-circle-half"></i>
  </button>
  <ul
    class="dropdown-menu dropdown-menu-end p-2"
    aria-labelledby="themeDropdown"
    style="min-width: 220px;"
  >
    <!-- Mode Toggle -->
    <li><h6 class="dropdown-header">Mode</h6></li>
    <li class="mb-3 px-2">
      <div class="btn-group w-100" role="group">
        <button
          type="button"
          class="btn btn-sm btn-outline-secondary mode-btn active"
          data-mode="light"
        >
          <i class="bi bi-sun-fill"></i> Light
        </button>
        <button type="button" class="btn btn-sm btn-outline-secondary mode-btn" data-mode="dark">
          <i class="bi bi-moon-stars-fill"></i> Dark
        </button>
      </div>
    </li>

    <li><hr class="dropdown-divider" /></li>

    <!-- Theme Color -->
    <li><h6 class="dropdown-header">Theme Color</h6></li>
    <li>
      <div class="d-flex flex-wrap gap-2 px-2 justify-content-center">
        <!-- Blue (Default) -->
        <button
          class="btn btn-sm rounded-circle p-0 border-0 theme-btn"
          data-color="blue"
          style="width: 24px; height: 24px; background-color: #00629B;"
          title="Blue (Default)"></button>
        <!-- Teal -->
        <button
          class="btn btn-sm rounded-circle p-0 border-0 theme-btn"
          data-color="teal"
          style="width: 24px; height: 24px; background-color: #00897B;"
          title="Teal"></button>
        <!-- Green -->
        <button
          class="btn btn-sm rounded-circle p-0 border-0 theme-btn"
          data-color="green"
          style="width: 24px; height: 24px; background-color: #2E7D32;"
          title="Green"></button>
        <!-- Purple -->
        <button
          class="btn btn-sm rounded-circle p-0 border-0 theme-btn"
          data-color="purple"
          style="width: 24px; height: 24px; background-color: #8E24AA;"
          title="Purple"></button>
        <!-- Orange -->
        <button
          class="btn btn-sm rounded-circle p-0 border-0 theme-btn"
          data-color="orange"
          style="width: 24px; height: 24px; background-color: #F57F17;"
          title="Orange"></button>
        <!-- Red -->
        <button
          class="btn btn-sm rounded-circle p-0 border-0 theme-btn"
          data-color="red"
          style="width: 24px; height: 24px; background-color: #D32F2F;"
          title="Red"></button>
      </div>
    </li>
  </ul>
</div>

<script>
  // --- Initialization ---
  const storedTheme = localStorage.getItem('ez-theme') || 'blue';
  const storedMode = localStorage.getItem('ez-mode') || 'light';

  document.documentElement.setAttribute('data-ez-theme', storedTheme);
  document.documentElement.setAttribute('data-bs-theme', storedMode);

  // Update Active State for Mode Buttons
  const updateModeButtons = (mode) => {
    document.querySelectorAll('.mode-btn').forEach((btn) => {
      if (btn.getAttribute('data-mode') === mode) {
        btn.classList.add('active', 'btn-secondary');
        btn.classList.remove('btn-outline-secondary');
      } else {
        btn.classList.remove('active', 'btn-secondary');
        btn.classList.add('btn-outline-secondary');
      }
    });
  };

  updateModeButtons(storedMode);

  // --- Event Listeners ---

  // Theme Color
  document.querySelectorAll('.theme-btn').forEach((btn) => {
    btn.addEventListener('click', () => {
      const color = btn.getAttribute('data-color');
      if (color) {
        document.documentElement.setAttribute('data-ez-theme', color);
        localStorage.setItem('ez-theme', color);
      }
    });
  });

  // Dark/Light Mode
  document.querySelectorAll('.mode-btn').forEach((btn) => {
    btn.addEventListener('click', () => {
      const mode = btn.getAttribute('data-mode');
      if (mode) {
        document.documentElement.setAttribute('data-bs-theme', mode);
        localStorage.setItem('ez-mode', mode);
        updateModeButtons(mode);
      }
    });
  });
</script>

<style>
  .theme-btn {
    transition: transform 0.2s;
    cursor: pointer;
  }
  .theme-btn:hover {
    transform: scale(1.2);
  }
  .mode-btn {
    cursor: pointer;
  }
</style>
